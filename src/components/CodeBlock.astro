---
import { Icon } from "astro-icon/components";
import { codeToHtml } from "shiki";
import { transformerMetaHighlight } from "@shikijs/transformers";
import BtnCopy from "./BtnCopy.jsx";

const { code, name, meta } = Astro.props;

const hasFileName = !!name;

const textCode = await codeToHtml(code, {
  lang: "astro",
  themes: {
    light: "vitesse-light",
    dark: "vitesse-dark",
  },
  transformers: [
    {
      code(node) {
        this.addClassToHast(node, "astro");
      },
    },
    transformerMetaHighlight(),
  ],
  meta: {
    __raw: meta,
  },
});
---

<figure class="flex flex-col gap-1 w-full h-full overflow-hidden">
  <div
    class="flex items-center justify-between px-[15px] py-[10px] border-b border-g-200"
  >
    <figcaption class="sticky top-0 flex items-center gap-2">
      <Icon name="astro" class="text-small" />
      {
        hasFileName && (
          <p class="filename text-small flex">
            <span>./src/components/ui/</span>
            <span class="text-ghost">{name}</span>
            <span class="text-ghost">.astro</span>
          </p>
        )
      }
    </figcaption>
    <BtnCopy code={code} client:load />
  </div>
  <pre class="overflow-scroll" set:html={textCode} />
</figure>
